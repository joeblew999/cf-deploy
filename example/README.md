# cf-deploy Example

A complete, live Cloudflare Worker managed by cf-deploy.

**Live**: https://cf-deploy-example.gedw99.workers.dev

## What's Here

```
example/
  cf-deploy.yml          # cf-deploy config
  wrangler.toml          # Cloudflare Worker config
  package.json           # version + dependencies (Hono, wrangler)
  src/index.ts           # Hono worker with /api/health
  public/
    index.html           # Page with version picker
    version-picker.js    # Vanilla Web Component (copied from ../web/)
    versions.json        # Generated by cf-deploy versions-json
```

## Run Locally

```sh
bun install
bun x wrangler dev    # → http://localhost:8788
```

The version picker works on localhost too — it detects `localhost` and shows "local" badge.

## Deploy Lifecycle

```sh
# Upload a new version (does NOT go to production)
cf-deploy upload --version 1.0.0

# Generate versions.json manifest
cf-deploy versions-json

# Smoke test the preview URL
cf-deploy smoke

# Promote to production (100% traffic)
cf-deploy promote

# View all deployed versions
cf-deploy list

# Tear down the worker entirely
cf-deploy delete
```

## How It Works

1. `cf-deploy upload` wraps `wrangler versions upload` with version tagging and preview aliases
2. `cf-deploy versions-json` queries wrangler + git to generate a static `versions.json`
3. `versions.json` is deployed as a static asset alongside your app
4. The `<cf-version-picker>` reads it at page load — no API calls to Cloudflare at runtime
5. `cf-deploy promote` reads `versions.json` to find the latest versionId and deploys it

## Task Runner Integration

### go-task

```yaml
tasks:
  "cf:upload":
    cmds: [cf-deploy upload]
  "cf:promote":
    cmds: [cf-deploy promote]
  "cf:smoke":
    cmds: [cf-deploy smoke]
```

### npm scripts

```json
{
  "scripts": {
    "deploy:upload": "cf-deploy upload",
    "deploy:promote": "cf-deploy promote"
  }
}
```

### Makefile

```makefile
CF = cf-deploy
upload:  ; $(CF) upload
promote: ; $(CF) promote
smoke:   ; $(CF) smoke
```
